{"filter":false,"title":"Server.js","tooltip":"/Server.js","undoManager":{"mark":78,"position":78,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":89,"column":0},"action":"insert","lines":["var DEBUG = true","var PORT = process.env.PORT","var HOST = process.env.IP","var INIT_MESSAGES = 5","","var http = require('http');","var fs = require('fs');","var url = require(\"url\");","var path = require(\"path\");","","","var server = http.createServer(function(request, response) {"," ","  var uri = url.parse(request.url).pathname","    , filename = path.join(process.cwd(), uri);","  ","  path.exists(filename, function(exists) {","    if(!exists) {","      response.writeHead(404, {\"Content-Type\": \"text/plain\"});","      response.write(\"404 Not Found\\n\");","      response.end();","      return;","    }"," ","    if (fs.statSync(filename).isDirectory()) filename += 'Index.html';"," ","    fs.readFile(filename, \"binary\", function(err, file) {","      if(err) {        ","        response.writeHead(500, {\"Content-Type\": \"text/plain\"});","        response.write(err + \"\\n\");","        response.end();","        return;","      }"," ","      response.writeHead(200);","      response.write(file, \"binary\");","      response.end();","    });","  });","}).listen(PORT)","","var io = require('socket.io').listen(server)","io.set ('transports', ['websocket', 'polling'])","","var _data = {};","_data.note = 1;","var _connections = 0;","","Array.prototype.inject = function(element) {","","    if (this.length >= INIT_MESSAGES) {","        this.shift()","    }","    this.push(element)","}","","io.sockets.on('connection', function(client) {","","    _connections++;","    ","    if (DEBUG)","        console.log(\"New Connection: \", client.id)","","    client.emit(\"init\", JSON.stringify(_data))","","    client.on('msg', function(msg) {","      ","        // if (DEBUG)","        //     console.log(\"Message: \" + msg)","","        var newData = JSON.parse(msg);","        ","        if(newData.note >= 85){","            newData.note = 1;","        }","        _data = newData;","        _data.connections = _connections;","        client.broadcast.emit('msg', _data);","        client.emit('msg', _data);","    })","","    client.on('disconnect', function() {","","        _connections--;","        ","        if (DEBUG)","            console.log(\"Disconnected: \", client.id)","    })","})",""]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":21},"end":{"row":4,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":43,"column":0},"end":{"row":45,"column":21},"action":"remove","lines":["var _data = {};","_data.note = 1;","var _connections = 0;"]}]}],[{"group":"doc","deltas":[{"start":{"row":43,"column":0},"end":{"row":44,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":44,"column":0},"end":{"row":50,"column":1},"action":"remove","lines":["Array.prototype.inject = function(element) {","","    if (this.length >= INIT_MESSAGES) {","        this.shift()","    }","    this.push(element)","}"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":0},"end":{"row":48,"column":19},"action":"remove","lines":["    _connections++;"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":0},"end":{"row":49,"column":4},"action":"remove","lines":["","    "]}]}],[{"group":"doc","deltas":[{"start":{"row":67,"column":8},"end":{"row":67,"column":9},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":67,"column":9},"end":{"row":67,"column":10},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":72,"column":0},"end":{"row":72,"column":22},"action":"remove","lines":["        _connections--"]}]}],[{"group":"doc","deltas":[{"start":{"row":72,"column":0},"end":{"row":72,"column":1},"action":"remove","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":72,"column":0},"end":{"row":73,"column":8},"action":"remove","lines":["","        "]}]}],[{"group":"doc","deltas":[{"start":{"row":72,"column":0},"end":{"row":73,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":70,"column":40},"end":{"row":71,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":49,"column":14},"end":{"row":50,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":49,"column":14},"end":{"row":49,"column":15},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":49,"column":14},"end":{"row":49,"column":15},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":49,"column":14},"end":{"row":49,"column":15},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":49,"column":14},"end":{"row":49,"column":15},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":49,"column":14},"end":{"row":49,"column":15},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":49,"column":14},"end":{"row":49,"column":15},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":49,"column":14},"end":{"row":49,"column":15},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":60,"column":0},"end":{"row":62,"column":9},"action":"remove","lines":["        if(newData.note >= 85){","            newData.note = 1;","        }"]}]}],[{"group":"doc","deltas":[{"start":{"row":58,"column":15},"end":{"row":58,"column":16},"action":"remove","lines":["D"]}]}],[{"group":"doc","deltas":[{"start":{"row":58,"column":14},"end":{"row":58,"column":15},"action":"remove","lines":["w"]}]}],[{"group":"doc","deltas":[{"start":{"row":58,"column":13},"end":{"row":58,"column":14},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":58,"column":12},"end":{"row":58,"column":13},"action":"remove","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":58,"column":12},"end":{"row":58,"column":13},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":63,"column":37},"end":{"row":63,"column":42},"action":"remove","lines":["_data"]},{"start":{"row":63,"column":37},"end":{"row":63,"column":41},"action":"insert","lines":["data"]}]}],[{"group":"doc","deltas":[{"start":{"row":60,"column":0},"end":{"row":62,"column":41},"action":"remove","lines":["","        _data = newData;","        _data.connections = _connections;"]}]}],[{"group":"doc","deltas":[{"start":{"row":59,"column":8},"end":{"row":60,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":59,"column":4},"end":{"row":59,"column":8},"action":"remove","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":59,"column":0},"end":{"row":59,"column":4},"action":"remove","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":55,"column":9},"end":{"row":55,"column":10},"action":"remove","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":55,"column":8},"end":{"row":55,"column":9},"action":"remove","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":55,"column":19},"end":{"row":56,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":55,"column":19},"end":{"row":55,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":55,"column":19},"end":{"row":55,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":55,"column":19},"end":{"row":55,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":55,"column":19},"end":{"row":55,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":55,"column":19},"end":{"row":55,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":55,"column":19},"end":{"row":55,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":55,"column":19},"end":{"row":55,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":55,"column":19},"end":{"row":55,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":55,"column":19},"end":{"row":55,"column":20},"action":"remove","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":55,"column":19},"end":{"row":55,"column":20},"action":"remove","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":55,"column":19},"end":{"row":55,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":55,"column":19},"end":{"row":55,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":55,"column":19},"end":{"row":55,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":55,"column":19},"end":{"row":55,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":55,"column":19},"end":{"row":55,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":55,"column":19},"end":{"row":55,"column":20},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":55,"column":8},"end":{"row":55,"column":9},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":51,"column":39},"end":{"row":51,"column":44},"action":"remove","lines":["_data"]},{"start":{"row":51,"column":39},"end":{"row":51,"column":45},"action":"insert","lines":["client"]}]}],[{"group":"doc","deltas":[{"start":{"row":64,"column":18},"end":{"row":65,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":64,"column":18},"end":{"row":64,"column":19},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":64,"column":19},"end":{"row":64,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":64,"column":19},"end":{"row":64,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":64,"column":19},"end":{"row":64,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":64,"column":19},"end":{"row":64,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":64,"column":19},"end":{"row":64,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":64,"column":19},"end":{"row":64,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":64,"column":19},"end":{"row":64,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":64,"column":19},"end":{"row":64,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":64,"column":19},"end":{"row":64,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":64,"column":19},"end":{"row":64,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":64,"column":19},"end":{"row":64,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":64,"column":19},"end":{"row":64,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":41,"column":47},"end":{"row":42,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":41,"column":47},"end":{"row":42,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":44,"column":46},"end":{"row":45,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":39},"end":{"row":48,"column":45},"action":"remove","lines":["client"]},{"start":{"row":48,"column":39},"end":{"row":48,"column":40},"action":"insert","lines":["'"]}]}],[{"group":"doc","deltas":[{"start":{"row":48,"column":40},"end":{"row":48,"column":41},"action":"insert","lines":["'"]}]}],[{"group":"doc","deltas":[{"start":{"row":52,"column":18},"end":{"row":52,"column":19},"action":"insert","lines":["*"]}]}],[{"group":"doc","deltas":[{"start":{"row":52,"column":19},"end":{"row":52,"column":20},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":52,"column":19},"end":{"row":52,"column":20},"action":"remove","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":52,"column":18},"end":{"row":52,"column":19},"action":"remove","lines":["*"]}]}],[{"group":"doc","deltas":[{"start":{"row":52,"column":8},"end":{"row":52,"column":9},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":52,"column":9},"end":{"row":52,"column":10},"action":"insert","lines":["/"]}]}]]},"ace":{"folds":[],"customSyntax":"javascript","scrolltop":555,"scrollleft":0,"selection":{"start":{"row":52,"column":10},"end":{"row":52,"column":10},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":71,"mode":"ace/mode/javascript"}},"timestamp":1421705567538,"hash":"f4aa0c7b521d4aa4425ed0c03bc909448a0fd809"}